<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-04-18
 | Rendered using Hippo Forge Maven Skin 1.04.00 based on Apache Maven Fluido Skin
-->
<!--[if lt IE 7]><html id="ie6" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 7]><html id="ie7" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 8]><html id="ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if IE 9]><html id="ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if !IE]>--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                    <meta name="Date-Revision-yyyymmdd" content="20170418"/>
                <meta http-equiv="Content-Language" content="en"/>
        <title>Hippo CMS Document Commenting Plugin &#x2013; Developer's How-to (Hippo CMS Document Commenting Plugin)</title>
    <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/forge-maven-skin-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/site.css"/>
    <link rel="stylesheet" href="./css/print.css" media="print"/>

        
    <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-1.04.00.min.js"></script>
    <script type="text/javascript" src="./js/forge-maven-skin-1.04.00.min.js"></script>

    
            </head>
    <body>

        
    
    
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="header">
                <div id="logo">
                    <a href="http://www.onehippo.com">
                        <img src="./images/hipposkin/hippo-logo.png" alt="Hippo Logo" />
                    </a>
                </div>

                <h1>
                                            Hippo CMS Document Commenting Plugin
                    
                </h1>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="row-fluid">
            <div id="breadcrumbs" class="clearfix">
                <ul class="breadcrumb">
                                
                                        
                            <li id="publishDate">Last Published: 2017-04-18</li>
                                                                                                                                                </ul>

                <div class="links">
                    <a href="https://www.onehippo.com">Onehippo.com</a>
                    <a href="https://www.onehippo.org">Onehippo.org</a>
                </div>
            </div>
        </div>



            
    <div class="row-fluid">
        <div id="leftColumn" class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                                        <li class="nav-header">Main</li>
                                                           
        <li>
    
                                                <a href="index.html" title="Welcome">
                    <i class="none"></i>
                Welcome</a>
                    </li>
                               
        <li>
    
                                                <a href="install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                               
        <li class="active">
    
                        <a href="#"><i class="none"></i>Developer's how-to</a>
                </li>
                                                                                                                                               
        <li>
    
                                                <a href="jcr-comment-persistence-manager.html" title="CommentPersistenceManager implementation(s)">
                    <i class="icon-chevron-down"></i>
                CommentPersistenceManager implementation(s)</a>
                                        <ul class="nav nav-list">
                                                          
        <li>
    
                                                <a href="jcr-comment-persistence-manager.html" title="DefaultJcrCommentPersistenceManager">
                    <i class="none"></i>
                DefaultJcrCommentPersistenceManager</a>
                    </li>
                                              </ul>
            </li>
                               
        <li>
    
                                                <a href="release-notes.html" title="Release Notes">
                    <i class="none"></i>
                Release Notes</a>
                    </li>
                                                            <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        <li>
    
                                                <a href="project-info.html" title="Project Information">
                    <i class="icon-chevron-right"></i>
                Project Information</a>
                                </li>
                                                                                                                                                                                                                                                                                                                                                                       
        <li>
    
                                                <a href="project-reports.html" title="Project Reports">
                    <i class="icon-chevron-right"></i>
                Project Reports</a>
                                </li>
                        </ul>

                
                <hr class="divider"/>

                <div id="poweredBy">
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                                <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                            </div>
            </div>
        </div>
    
        
        <div id="bodyColumn"  class="span9" >
                                
            <!-- Copyright 2016-2016 Hippo

    Licensed under the Apache License, Version 2.0 (the  "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License. -->
  
    <div class="section">
<h2><a name="Developers_How-to_Hippo_CMS_Document_Commenting_Plugin"></a>Developer's How-to (Hippo CMS Document Commenting Plugin)</h2>

      
<div class="section">
<h3><a name="Configuring_Commenting_Field_in_Document_Template_a.k.a_namespace"></a>Configuring 'Commenting' Field in Document Template (a.k.a 'namespace')</h3>
        
<p>
          In a namespace bootstrap XML file, you should add a custom field like the following example:
        </p>
        
<div class="brush: xml">
          
<div class="source"><pre class="prettyprint linenums">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;sv:node sv:name=&quot;newsdocument&quot; xmlns:sv=&quot;http://www.jcp.org/jcr/sv/1.0&quot;&gt;
  &lt;sv:property sv:name=&quot;jcr:primaryType&quot; sv:type=&quot;Name&quot;&gt;
    &lt;sv:value&gt;hipposysedit:templatetype&lt;/sv:value&gt;
  &lt;/sv:property&gt;

  &lt;!-- SNIP --&gt;

  &lt;sv:node sv:name=&quot;editor:templates&quot;&gt;
    &lt;sv:property sv:name=&quot;jcr:primaryType&quot; sv:type=&quot;Name&quot;&gt;
      &lt;sv:value&gt;editor:templateset&lt;/sv:value&gt;
    &lt;/sv:property&gt;
    &lt;sv:node sv:name=&quot;_default_&quot;&gt;
      &lt;sv:property sv:name=&quot;jcr:primaryType&quot; sv:type=&quot;Name&quot;&gt;
        &lt;sv:value&gt;frontend:plugincluster&lt;/sv:value&gt;
      &lt;/sv:property&gt;

      &lt;!-- SNIP --&gt;

      &lt;!--
        You should add something like the following for a Document Commenting field.
        Most part will be used without modification.
      --&gt;

      &lt;sv:node sv:name=&quot;document-commenting&quot;&gt;
        &lt;sv:property sv:name=&quot;jcr:primaryType&quot; sv:type=&quot;Name&quot;&gt;
          &lt;sv:value&gt;frontend:plugin&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;caption&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;Comments&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;engine&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;${engine}&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;mode&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;${mode}&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;plugin.class&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;org.onehippo.forge.document.commenting.cms.impl.DefaultDocumentCommentingFieldPlugin&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;selection.mode&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;multiple&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;wicket.id&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;${cluster.id}.right.item&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;wicket.model&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;${wicket.model}&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;comment.persistence.manager&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;org.onehippo.forge.document.commenting.cms.impl.DefaultJcrCommentPersistenceManager&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;comment.query.limit&quot; sv:type=&quot;Long&quot;&gt;
          &lt;sv:value&gt;100&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;dialog.size&quot; sv:type=&quot;String&quot;&gt;
          &lt;sv:value&gt;width=600,height=400&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;comment.editable.author.only&quot; sv:type=&quot;Boolean&quot;&gt;
          &lt;sv:value&gt;false&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:property sv:name=&quot;comment.deletable.author.only&quot; sv:type=&quot;Boolean&quot;&gt;
          &lt;sv:value&gt;false&lt;/sv:value&gt;
        &lt;/sv:property&gt;
        &lt;sv:node sv:name=&quot;cluster.options&quot;&gt;
          &lt;sv:property sv:name=&quot;jcr:primaryType&quot; sv:type=&quot;Name&quot;&gt;
            &lt;sv:value&gt;frontend:pluginconfig&lt;/sv:value&gt;
          &lt;/sv:property&gt;
          &lt;sv:property sv:name=&quot;jcr.comment.persistence.query&quot; sv:type=&quot;String&quot;&gt;
            &lt;sv:value&gt;//element(*,doccommenting:commentdata)[@doccommenting:subjectid=''{0}''] order by @doccommenting:created descending&lt;/sv:value&gt;
          &lt;/sv:property&gt;
          &lt;sv:property sv:name=&quot;jcr.comment.persistence.date.format&quot; sv:type=&quot;String&quot;&gt;
            &lt;sv:value&gt;yyyy-MM-dd HH:mm:ss&lt;/sv:value&gt;
          &lt;/sv:property&gt;
        &lt;/sv:node&gt;
      &lt;/sv:node&gt;

      &lt;!-- SNIP --&gt;

    &lt;/sv:node&gt;
  &lt;/sv:node&gt;
&lt;/sv:node&gt;
          </pre></div>
        </div>
        
<p>
          See the following for a full example in the demo project:
          <a class="externalLink" href="https://github.com/onehippo-forge/document-commenting/blob/master/demo/bootstrap/configuration/src/main/resources/namespaces/doccommentingdemo/newsdocument.xml">
            https://github.com/onehippo-forge/document-commenting/blob/master/demo/bootstrap/configuration/src/main/resources/namespaces/doccommentingdemo/newsdocument.xml
          </a>
        </p>
        
      </div>

      
<div class="section">
<h3><a name="Implementing_your_own_CommentPersistenceManager_service"></a>Implementing your own CommentPersistenceManager service</h3>
        
<p>
          The Document Commenting plugin actually doesn't store/read data by itself, but relies on
          a <tt>CommentPersistenceManager</tt> service implementation specified in the plugin configuration as shown above.
          Therefore, you may extend the default implementation or you can replace it with a totally new implementation to
          support a different comment data storage (e.g, NoSQL database) for instance.
        </p>
        
<p>
          See an example <tt>CommentPersistenceManager</tt> implementation code here:
          <a class="externalLink" href="https://github.com/onehippo-forge/document-commenting/blob/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/CustomPrioritizingJcrCommentPersistenceManager.java">
            https://github.com/onehippo-forge/document-commenting/blob/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/CustomPrioritizingJcrCommentPersistenceManager.java
          </a>
        </p>
        
<p>
          The example custom service implementation is used in the 'event' document namespace for demonstration purpose in the demo project.
        </p>
        
<p>
          Put your own implementation class in your CMS module project.
        </p>
        
<p>
          See <a href="apidocs/index.html">Javadocs</a> for detail about the <tt>CommentPersistenceManager</tt>.
        </p>
      </div>

      
<div class="section">
<h3><a name="Plugin_Parameters"></a>Plugin Parameters</h3>
        
<p>
          You may configure the following plugin parameters in the field definition of your document template definition (a.k.a 'namespace').
        </p>
        
<table border="0" class="table table-striped">
          
<tr class="a">
            
<th>Parameter name</th>
            
<th>Description</th>
            
<th>Example value(s)</th>
            
<th>Default value(s)</th>
          </tr>
          
<tr class="b">
            
<td>caption</td>
            
<td>Field caption, used as field label and dialog title.</td>
            
<td>&quot;Remarks&quot;</td>
            
<td>&quot;Comments&quot;</td>
          </tr>
          
<tr class="a">
            
<td>comment.persistence.manager</td>
            
<td><tt>org.onehippo.forge.document.commenting.cms.api.CommentPersistenceManager</tt> implementation class FQN.</td>
            
<td>&quot;org.onehippo.forge.document.commenting.cms.impl.DefaultJcrCommentPersistenceManager&quot;</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>comment.query.limit</td>
            
<td>
              The JCR query limit when retrieving the latest comment data by subject ID.
            </td>
            
<td>20</td>
            
<td>100</td>
          </tr>
          
<tr class="a">
            
<td>dialog.size</td>
            
<td>The size of the picker popup dialog.</td>
            
<td>&quot;width=500,height=350&quot;</td>
            
<td>&quot;width=600,height=400&quot;</td>
          </tr>
          
<tr class="b">
            
<td>comment.editable.author.only</td>
            
<td>
              Whether or not each comment can be edited only by the original comment author.
            </td>
            
<td>true</td>
            
<td>false</td>
          </tr>
          
<tr class="a">
            
<td>comment.deletable.author.only</td>
            
<td>
              Whether or not each comment can be deleted only by the original comment author.
            </td>
            
<td>true</td>
            
<td>false</td>
          </tr>
        </table>
      </div>

      
<div class="section">
<h3><a name="Parameters_of_DefaultJcrCommentPersistenceManager"></a>Parameters of DefaultJcrCommentPersistenceManager</h3>
        
<p>
          The following parameters are set for the <tt>DefaultJcrCommentPersistenceManager</tt> implementation
          additionally (under <tt>cluster.options</tt> node).
        </p>
        
<table border="0" class="table table-striped">
          
<tr class="a">
            
<th>Parameter name</th>
            
<th>Description</th>
            
<th>Example value(s)</th>
            
<th>Default value(s)</th>
          </tr>
          
<tr class="b">
            
<td>jcr.comment.persistence.query</td>
            
<td>The JCR XPath query used when retrieving the latest comment data in the field area.</td>
            
<td>
              //element(*,doccommenting:commentdata)[@doccommenting:subjectid=''{0}''] order by @doccommenting:lastModified descending
            </td>
            
<td>
              //element(*,doccommenting:commentdata)[@doccommenting:subjectid=''{0}''] order by @doccommenting:created descending
            </td>
          </tr>
          
<tr class="a">
            
<td>jcr.comment.persistence.date.format</td>
            
<td>The date format string to display</td>
            
<td>
              MM/dd/yyyy HH:mm:ss
            </td>
            
<td>
              yyyy-MM-dd HH:mm:ss
            </td>
          </tr>
        </table>
      </div>

    </div>
  

            </div>
        </div>
    </div>

    <hr/>

    <footer>
                <div class="container-fluid">
                <div class="row span12">Copyright &copy;                                                2017.
                        All Rights Reserved.            
                                        
            </div>

        
        
                </div>
    </footer>
</body>
</html>
