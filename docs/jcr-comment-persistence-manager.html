<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-04-18
 | Rendered using Hippo Forge Maven Skin 1.04.00 based on Apache Maven Fluido Skin
-->
<!--[if lt IE 7]><html id="ie6" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 7]><html id="ie7" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 8]><html id="ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if IE 9]><html id="ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if !IE]>--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                    <meta name="Date-Revision-yyyymmdd" content="20170418"/>
                <meta http-equiv="Content-Language" content="en"/>
        <title>Hippo CMS Document Commenting Plugin &#x2013; DefaultJcrCommentPersistenceManager</title>
    <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/forge-maven-skin-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/site.css"/>
    <link rel="stylesheet" href="./css/print.css" media="print"/>

        
    <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-1.04.00.min.js"></script>
    <script type="text/javascript" src="./js/forge-maven-skin-1.04.00.min.js"></script>

    
            </head>
    <body>

        
    
    
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="header">
                <div id="logo">
                    <a href="http://www.onehippo.com">
                        <img src="./images/hipposkin/hippo-logo.png" alt="Hippo Logo" />
                    </a>
                </div>

                <h1>
                                            Hippo CMS Document Commenting Plugin
                    
                </h1>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="row-fluid">
            <div id="breadcrumbs" class="clearfix">
                <ul class="breadcrumb">
                                
                                        
                            <li id="publishDate">Last Published: 2017-04-18</li>
                                                                                                                                                </ul>

                <div class="links">
                    <a href="https://www.onehippo.com">Onehippo.com</a>
                    <a href="https://www.onehippo.org">Onehippo.org</a>
                </div>
            </div>
        </div>



            
    <div class="row-fluid">
        <div id="leftColumn" class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                                        <li class="nav-header">Main</li>
                                                           
        <li>
    
                                                <a href="index.html" title="Welcome">
                    <i class="none"></i>
                Welcome</a>
                    </li>
                               
        <li>
    
                                                <a href="install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                               
        <li>
    
                                                <a href="dev-howto.html" title="Developer's how-to">
                    <i class="none"></i>
                Developer's how-to</a>
                    </li>
                                                                                                                                                                   
        <li class="active">
    
                        <a href="#"><i class="icon-chevron-down"></i>CommentPersistenceManager implementation(s)</a>
                                    <ul class="nav nav-list">
                                                          
        <li class="active">
    
                        <a href="#"><i class="none"></i>DefaultJcrCommentPersistenceManager</a>
                </li>
                                              </ul>
            </li>
                               
        <li>
    
                                                <a href="release-notes.html" title="Release Notes">
                    <i class="none"></i>
                Release Notes</a>
                    </li>
                                                            <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        <li>
    
                                                <a href="project-info.html" title="Project Information">
                    <i class="icon-chevron-right"></i>
                Project Information</a>
                                </li>
                                                                                                                                                                                                                                                                                                                                                                       
        <li>
    
                                                <a href="project-reports.html" title="Project Reports">
                    <i class="icon-chevron-right"></i>
                Project Reports</a>
                                </li>
                        </ul>

                
                <hr class="divider"/>

                <div id="poweredBy">
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                                <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                            </div>
            </div>
        </div>
    
        
        <div id="bodyColumn"  class="span9" >
                                
            <!-- Copyright 2016-2016 Hippo

    Licensed under the Apache License, Version 2.0 (the  "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License. -->
  
    <div class="section">
<h2><a name="DefaultJcrCommentPersistenceManager"></a>DefaultJcrCommentPersistenceManager</h2>
      
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
        
<p>
          The default implementation of <tt>CommentPersistenceManager</tt>,
          <a href="apidocs/org/onehippo/forge/document/commenting/cms/impl/DefaultJcrCommentPersistenceManager.html">DefaultJcrCommentPersistenceManager</a>,
          stores comment data in JCR repository
          in a specific node tree, similarly to how Hippo Workflow logging data or HST Form data is stored.
        </p>
      </div>
      
<div class="section">
<h3><a name="Comment_Data_Node_Types"></a>Comment Data Node Types</h3>
        
<p>
          <tt>DefaultJcrCommentPersistenceManager</tt> uses the following node types:
        </p>
        
<div class="brush: plain">
          
<div class="source"><pre class="prettyprint linenums">
&lt;'mix'='http://www.jcp.org/jcr/mix/1.0'&gt;
&lt;'nt'='http://www.jcp.org/jcr/nt/1.0'&gt;
&lt;'doccommenting'='http://forge.onehippo.org/doccommenting/nt/1.0'&gt;

[doccommenting:commentdata] &gt; nt:base
  - doccommenting:subjectid (string)
  - doccommenting:author (string)
  - doccommenting:created (date)
  - doccommenting:lastModified (date)
  - doccommenting:content (string)
  - * (string)
  - * (string) multiple
  - * (boolean)
  - * (boolean) multiple
  - * (long)
  - * (long) multiple
  - * (double)
  - * (double) multiple
  - * (date)
  - * (date) multiple

[doccommenting:commentdatacontainer] &gt; nt:base
  + * (doccommenting:commentdata)
  + * (doccommenting:commentdatacontainer)
          </pre></div>
        </div>
        
<p>
          <tt>doccommenting:commentdatacontainer</tt> type is used for folder nodes
          (which are randomly created and selected for scalability)
          and <tt>doccommenting:commentdata</tt> is used for each comment data node.
        </p>
        
<p>
          Please note that a <tt>doccommenting:commentdata</tt> has <b>basic</b> properties:
        </p>
        
<ul>
          
<li><tt>doccommenting:subjectid</tt>: used for the related document handle node identifier of the comment data</li>
          
<li><tt>doccommenting:author</tt>: used for the author name of the comment data</li>
          
<li><tt>doccommenting:created</tt>: used for the creation datetime of the comment data</li>
          
<li><tt>doccommenting:lastModified</tt>: used for the last modified datetime of the comment data</li>
          
<li><tt>doccommenting:content</tt>: used for the text content of the comment data</li>
        </ul>
        
<p>
          In addition, for more extensibility/customizability,
          a <tt>doccommenting:commentdata</tt> node allows to store
          any ad hoc single-valued or multi-valued properties in different types (string, boolean, long, double and date).
        </p>
        
<p>
          You can find an example which takes advantage of this here:
        </p>
        
<p>
          <a class="externalLink" href="https://github.com/onehippo-forge/document-commenting/tree/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/">
            https://github.com/onehippo-forge/document-commenting/tree/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/
          </a>
        </p>
      </div>
      
<div class="section">
<h3><a name="Document_Commenting_Data_Node_Structure"></a>Document Commenting Data Node Structure</h3>
        
<p>
          One of the easiest way to look up the comment data is to use the Hippo CMS Repository Servlet (<tt>/cms/repository</tt>).
          So, you can execute query like the following example to search comment data:
        </p>
        <img src="images/repo-query.png" alt="Query in Repository Servlet" />
        
<p>
          It will show all the values of the default properties together in the result view.
        </p>
        
<p>
          You can also browse the data by the path in CMS Console like the following.
          CMS Console will show all the properties (not just the basic properties but also any custom/extended properties if you have any).
        </p>
        <img src="images/console-view.png" alt="View in CMS Console" />
        
<p>
          As you can see, it creates 26 folders from 'a' to 'z' in 4 levels initially
          and stores a comment node after selecting a fourth-level folder randomly.
          This way, it can store a lot of data in a more performant and scalable way.
        </p>
      </div>
    </div>
  

            </div>
        </div>
    </div>

    <hr/>

    <footer>
                <div class="container-fluid">
                <div class="row span12">Copyright &copy;                                                2017.
                        All Rights Reserved.            
                                        
            </div>

        
        
                </div>
    </footer>
</body>
</html>
