<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 at 2024-08-15 
 | Rendered using Bloomreach Forge Maven Skin 3.2.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20240815" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Bloomreach XM Document Commenting Plugin &#x2013; DefaultJcrCommentPersistenceManager</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.2.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.2.1.min.js"></script>

            <style>.github-fork-ribbon:before { background-color: green; }</style>
</head>
<body class="topBarDisabled">
              <a target="_blank" class="github-fork-ribbon right" href="https://github.com/bloomreach-forge/document-commenting"
     data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="Bloomreach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Bloomreach XM Document Commenting Plugin</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://xmdocumentation.bloomreach.com">xmdocumentation.bloomreach.com</a>
      <a href="https://github.com/bloomreach-forge">github.com/bloomreach-forge</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 2024-08-15  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Main</li>
              <li>  <a href="index.html" title="Welcome">  <span class="none"></span>  Welcome</a>  </li>
        <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li>  <a href="dev-howto.html" title="Developer's how-to">  <span class="none"></span>  Developer's how-to</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Persistence Manager</a>
  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
                  <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                                        <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
                                          <li>  <a href="project-reports.html" title="Project Reports">  <span class="icon-chevron-right"></span>  Project Reports</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  
    <section>
<h2><a name="DefaultJcrCommentPersistenceManager"></a>DefaultJcrCommentPersistenceManager</h2>
      <section>
<h3><a name="Introduction"></a>Introduction</h3>
        
<p>
          The default implementation of <code>CommentPersistenceManager</code>,
          <a href="apidocs/org/onehippo/forge/document/commenting/cms/impl/DefaultJcrCommentPersistenceManager.html">DefaultJcrCommentPersistenceManager</a>,
          stores comment data in JCR repository
          in a specific node tree, similarly to how Hippo Workflow logging data or HST Form data is stored.
        </p>
      </section>
      <section>
<h3><a name="Comment_Data_Node_Types"></a>Comment Data Node Types</h3>
        
<p>
          <code>DefaultJcrCommentPersistenceManager</code> uses the following node types:
        </p>
        
<div class="brush: plain">
          
<div class="source"><pre>
&lt;'mix'='http://www.jcp.org/jcr/mix/1.0'&gt;
&lt;'nt'='http://www.jcp.org/jcr/nt/1.0'&gt;
&lt;'doccommenting'='http://forge.onehippo.org/doccommenting/nt/1.0'&gt;

[doccommenting:commentdata] &gt; nt:base
  - doccommenting:subjectid (string)
  - doccommenting:author (string)
  - doccommenting:created (date)
  - doccommenting:lastModified (date)
  - doccommenting:content (string)
  - * (string)
  - * (string) multiple
  - * (boolean)
  - * (boolean) multiple
  - * (long)
  - * (long) multiple
  - * (double)
  - * (double) multiple
  - * (date)
  - * (date) multiple

[doccommenting:commentdatacontainer] &gt; nt:base
  + * (doccommenting:commentdata)
  + * (doccommenting:commentdatacontainer)
          </pre></div>
        </div>
        
<p>
          <code>doccommenting:commentdatacontainer</code> type is used for folder nodes
          (which are randomly created and selected for scalability)
          and <code>doccommenting:commentdata</code> is used for each comment data node.
        </p>
        
<p>
          Please note that a <code>doccommenting:commentdata</code> has <b>basic</b> properties:
        </p>
        
<ul>
          
<li><code>doccommenting:subjectid</code>: used for the related document handle node identifier of the comment data</li>
          
<li><code>doccommenting:author</code>: used for the author name of the comment data</li>
          
<li><code>doccommenting:created</code>: used for the creation datetime of the comment data</li>
          
<li><code>doccommenting:lastModified</code>: used for the last modified datetime of the comment data</li>
          
<li><code>doccommenting:content</code>: used for the text content of the comment data</li>
        </ul>
        
<p>
          In addition, for more extensibility/customizability,
          a <code>doccommenting:commentdata</code> node allows to store
          any ad hoc single-valued or multi-valued properties in different types (string, boolean, long, double and date).
        </p>
        
<p>
          You can find an example which takes advantage of this here:
        </p>
        
<p>
          <a class="externalLink" href="https://github.com/bloomreach-forge/document-commenting/tree/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/">
            https://github.com/bloomreach-forge/document-commenting/tree/master/demo/cms/src/main/java/org/onehippo/forge/document/commenting/demo/cms/
          </a>
        </p>
      </section>
      <section>
<h3><a name="Document_Commenting_Data_Node_Structure"></a>Document Commenting Data Node Structure</h3>
        
<p>
          One of the easiest way to look up the comment data is to use the Repository Servlet (<code>/cms/repository</code>).
          So, you can execute query like the following example to search comment data:
        </p>
        <img src="images/repo-query.png" alt="Query in Repository Servlet" />
        
<p>
          It will show all the values of the default properties together in the result view.
        </p>
        
<p>
          You can also browse the data by the path in CMS Console like the following.
          CMS Console will show all the properties (not just the basic properties but also any custom/extended properties if you have any).
        </p>
        <img src="images/console-view.png" alt="View in CMS Console" />
        
<p>
          As you can see, it creates 26 folders from 'a' to 'z' in 4 levels initially
          and stores a comment node after selecting a fourth-level folder randomly.
          This way, it can store a lot of data in a more performant and scalable way.
        </p>
      </section>
    </section>
  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2007&#x2013;2024
              <a href="https://www.bloomreach.com">Bloomreach</a>.
          
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

